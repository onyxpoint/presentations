<section>
  <h2>Full Execution Walkthrough</h2>
  <div>
    You can find all code and output at <a href="https://gist.github.com/peiriannydd/7059200">http://git.io/ZPuZNQ</a>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Properties and Parameters
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
newparam(:name) do isnamevar end

newparam(:foo) do
  Puppet.warning("Param :foo -&gt; Starting")
end

newproperty(:baz) do
  Puppet.warning("Property :baz -&gt; Starting")
end

newparam(:bar) do
  Puppet.warning("Param :bar -&gt; Starting")
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim>
warning: Param :foo -&gt; Starting
warning: Property :baz -&gt; Starting
warning: Param :bar -&gt; Starting
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Provider
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Globals
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
Puppet::Type.type(:ex_order).provide(:ruby) do
  Puppet.warning("Setting Property Class Variables")

  @@ex_order_classvars = {
    :example =&gt; true
  }

 (...)
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim>
warning: Setting Property Class Variables
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Name Parameter Munge
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
newparam(:name) do
  isnamevar
 
  munge do |value|
    Puppet.warning("#{value}: In the name parameter.")
    value
  end
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: In the name parameter.
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Provider
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Initializer
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
def initialize(*args)
  super(*args)
 
  Puppet.warning("Provider Initialization :name= '#{@resource[:name]}'")
  Puppet.warning("Provider Initialization :foo = '#{@resource[:foo]}'")
  Puppet.warning("Provider Initialization :bar = '#{@resource[:bar]}'")
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim>
warning: Provider Initialization :name= 'test'
warning: Provider Initialization :foo = ''
warning: Provider Initialization :bar = ''
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Property|Baz
      </h3></td>
    </tr>
  </table>

  <div>
    <pre><code data-trim class="ruby">
# newparam(:foo) do
# newproperty(:baz) do
# newparam(:bar) do
    </code></pre>
  </div>

  <div>
    <pre><code data-trim class="ruby">
 newproperty(:baz) do
  validate do |value|
    Puppet.warning("#{resource[:name]}: :baz -&gt; Validating")
    Puppet.warning("#{resource[:name]}: Foo -&gt; '#{resource[:foo]}'")
  end
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: Property :baz -&gt; Validating
warning: test: Foo -&gt; ''
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Parameter|Foo
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
# newparam(:foo) do
# newproperty(:baz) do
# newparam(:bar) do
    </code></pre>
  </div>

  <div>
    <pre><code data-trim class="ruby">
newparam(:foo) do
  validate do |value|
    Puppet.warning("#{resource[:name]}: Param :foo -&gt; Validating")
  end

  munge do |value|
    Puppet.warning("#{resource[:name]}: Param :foo -&gt; Munging")
    Puppet.warning("Where's Param :bar? Bar is '#{resource[:bar]}'")
    value
  end
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: Param :foo -&gt; Validating
warning: test: Param :foo -&gt; Munging
warning: Where's Param :bar? Bar is ''
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Parameter|Bar
      </h3></td>
    </tr>
  </table>
  <div onclick="hideDiv()">
    <pre><code data-trim class="ruby">
# newparam(:foo) do
# newproperty(:baz) do
# newparam(:bar) do
    </code></pre>
  </div>
  <div>
    <pre><code data-trim class="ruby">
newparam(:bar) do
  Puppet.warning("Param :bar -&gt; Starting")
  validate do |value|
    Puppet.warning("#{resource[:name]}: Param :bar -&gt; Validating")
  end
  munge do |value|
    Puppet.warning("#{resource[:name]}: Param :bar -&gt; Munging")
    Puppet.warning("Where's Param :foo? Foo is '#{resource[:foo]}'")
    value
  end
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: Param :bar -&gt; Validating
warning: test: Param :bar -&gt; Munging
warning: test: Where's Param :foo? Foo is 'foo' &lt;- Order Matters!
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Validation
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
validate do
  required_params = [:foo, :bar, :baz]
  Puppet.warning("#{self[:name]}: Validating")
  required_params.each do |param|
    if not self[param] then
      # Note how we show the user *where* the error is.
      raise Puppet::ParseError,"Oh noes! #{self.file}:#{self.line}"
    end
  end
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
Warning: test: Param :bar -&gt; Validating
    </code></pre>
  </div>
</section>

<section>
  <h1>ARE WE THERE YET?</h1>
  <img class="fragment" src='images/No.gif' alt="No"/>
  <p class="fragment" style="font-size: small">(Arrested Development, Fox/Netflix)</p>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Initializing
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
def initialize(args)
  super(args)

  Puppet.warning("#{self[:name]}: Type Initializing")

  num_ex_orders = @catalog.resources.find_all { |r|
    r.is_a?(Puppet::Type.type(:ex_order))
  }.count
  Puppet.warning("Ex_order's in the catalog: '#{num_ex_orders+1}'")
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: Type Initializing
warning: Ex_order's in the catalog: '1'
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Finish
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
def finish
      Puppet.warning("#{self[:name]}: Type Finishing")

      # Don't forget to call this *at the end*
      super
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: Type Finishing
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Autorequires
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
autorequire(:file) do
  Puppet.warning("#{self[:name]}: Autorequring")
  ["/tmp/foo"]
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: Autorequring
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Provider
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Baz|Getter
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
Puppet::Type.type(:ex_order).provide(:ruby) do
  def baz
    # This is what 'is' ends up being in insync?
    Puppet.warning("#{@resource[:name]}: In getter for :baz")
  end
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: In getter for :baz
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Type
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Baz|Insync?
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
newproperty(:baz) do
  def insync?(is)
    # This is simply what the native provider code would do.
    is == @should

    # Note, you have to use @resource, not resource here since
    # you're not in the property any more, you're in the provider.
    Puppet.warning("#{@resource[:name]}: In 'insync?' for :baz")

    # We're returning false just to see the rest of the components
    # fire off.
    false
  end
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: In 'insync?' for :baz
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
          Provider
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
          Baz|Setter
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
Puppet::Type.type(:ex_order).provide(:ruby) do
  def baz=(should)
    # Called if insync? is false
    Puppet.warning("#{@resource[:name]}: In setter for :baz")
  end
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: test: In setter for :baz
notice: /Stage[main]/Main/Ex_order[test]/baz: baz changed
        'test: In getter for :baz' to 'baz'
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
        Provider
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
        Flush
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
Puppet::Type.type(:ex_order).provide(:ruby) do
  def flush
    # This happens if *any* property was modified.
    Puppet.warning("Time to flush #{@resource[:name]}")
  end
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: Time to flush test
    </code></pre>
  </div>
</section>

<section>
  <table width=100%>
    <tr>
      <td style="text-align: left"><h3><strong>
        Provider
      </strong></h3></td>
      <td width=65% style="text-align: right"><h3>
        Post-Resource Eval
      </h3></td>
    </tr>
  </table>
  <div>
    <pre><code data-trim class="ruby">
# This is new in Puppet 3.4.0 and can be used for
# cleaning up any resource persistence since it happens after
# *all* resources of this type have been evaluated.

def self.post_resource_eval
  Puppet.warning("FINIS!!!!")
end
    </code></pre>

    <p><strong>Output</strong></p>

    <pre><code data-trim class="ruby">
warning: FINIS!!!!
    </code></pre>
  </div>
</section>
